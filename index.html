<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pushup & Pullup History Tracker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f7fa;
            color: #333;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: #4a90e2;
            color: white;
            padding: 20px 0;
            text-align: center;
            border-radius: 5px 5px 0 0;
            margin-bottom: 20px;
        }
        
        h1 {
            margin: 0;
        }
        
        .card {
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }
        
        .stat-card {
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 15px;
            text-align: center;
        }
        
        .stat-card h3 {
            margin-top: 0;
            font-size: 14px;
            color: #4a90e2;
        }
        
        .stat-card p {
            font-size: 20px;
            font-weight: bold;
            margin: 5px 0 0;
        }
        
        .pushup-stats .stat-card h3 {
            color: #4a90e2;
        }
        
        .pullup-stats .stat-card h3 {
            color: #e24a4a;
        }
        
        .exercise-title {
            margin-top: 0;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 2px solid;
        }
        
        .pushup-title {
            color: #4a90e2;
            border-color: #4a90e2;
        }
        
        .pullup-title {
            color: #e24a4a;
            border-color: #e24a4a;
        }
        
        .data-input {
            margin-bottom: 20px;
        }
        
        textarea {
            width: 100%;
            height: 150px;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            font-family: monospace;
            resize: vertical;
        }
        
        button {
            background-color: #4a90e2;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #357ab8;
        }
        
        .time-period {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .time-period button {
            flex: 1;
            background-color: #f5f7fa;
            color: #4a90e2;
            border: 1px solid #4a90e2;
        }
        
        .time-period button.active {
            background-color: #4a90e2;
            color: white;
        }
        
        .data-format {
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }
        
        #fileInput {
            display: block;
            margin-top: 10px;
        }
        
        .sample-data {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        .exercise-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .exercise-toggle button {
            flex: 1;
        }
        
        #pushupToggle {
            background-color: #4a90e2;
        }
        
        #pullupToggle {
            background-color: #e24a4a;
        }
        
        #pushupToggle.inactive, #pullupToggle.inactive {
            background-color: #f5f7fa;
            color: #333;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Pushup & Pullup History Tracker</h1>
        </div>
    </header>
    
    <div class="container">
        <div class="stats-grid">
            <div class="card pushup-stats">
                <h2 class="exercise-title pushup-title">Pushup Statistics</h2>
                <div class="stats-container">
                    <div class="stat-card">
                        <h3>Total</h3>
                        <p id="totalPushups">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Average/Day</h3>
                        <p id="averagePushups">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Max in One Day</h3>
                        <p id="maxPushups">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Current Streak</h3>
                        <p id="currentPushupStreak">0</p>
                    </div>
                </div>
            </div>
            
            <div class="card pullup-stats">
                <h2 class="exercise-title pullup-title">Pullup Statistics</h2>
                <div class="stats-container">
                    <div class="stat-card">
                        <h3>Total</h3>
                        <p id="totalPullups">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Average/Day</h3>
                        <p id="averagePullups">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Max in One Day</h3>
                        <p id="maxPullups">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Current Streak</h3>
                        <p id="currentPullupStreak">0</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="exercise-toggle">
                <button id="pushupToggle">Show Pushups</button>
                <button id="pullupToggle">Show Pullups</button>
            </div>
            
            <div class="time-period">
                <button class="period-btn active" data-period="week">Week</button>
                <button class="period-btn" data-period="month">Month</button>
                <button class="period-btn" data-period="year">Year</button>
                <button class="period-btn" data-period="all">All Time</button>
            </div>
            
            <div class="chart-container">
                <canvas id="exerciseChart"></canvas>
            </div>
        </div>
        
        <div class="card data-input">
            <h2>Import Your Data</h2>
            <p>Paste your workout data in JSON format or upload a CSV/JSON file:</p>
            <textarea id="dataInput" placeholder='[
  {"date": "2023-01-01", "exercise": "pushup", "count": 30},
  {"date": "2023-01-01", "exercise": "pullup", "count": 10},
  {"date": "2023-01-02", "exercise": "pushup", "count": 35},
  {"date": "2023-01-02", "exercise": "pullup", "count": 12}
]'></textarea>
            <div class="data-format">
                Format: An array of objects with "date" (YYYY-MM-DD), "exercise" ("pushup" or "pullup"), and "count" (number) properties.
                <br>
                <span class="sample-data">Example: [{"date": "2023-01-01", "exercise": "pushup", "count": 30}, {"date": "2023-01-01", "exercise": "pullup", "count": 10}]</span>
            </div>
            <p>Or upload a file:</p>
            <input type="file" id="fileInput" accept=".json,.csv">
            <button id="importBtn">Import Data</button>
        </div>
    </div>
    
    <script>
        // Chart initialization
        let exerciseChart;
        let workoutData = [];
        let showPushups = true;
        let showPullups = true;
        
        // Sample data for initial display
        const sampleData = [
            { date: '2023-02-01', exercise: 'pushup', count: 30 },
            { date: '2023-02-01', exercise: 'pullup', count: 12 },
            { date: '2023-02-02', exercise: 'pushup', count: 35 },
            { date: '2023-02-02', exercise: 'pullup', count: 14 },
            { date: '2023-02-03', exercise: 'pushup', count: 40 },
            { date: '2023-02-03', exercise: 'pullup', count: 15 },
            { date: '2023-02-04', exercise: 'pushup', count: 45 },
            { date: '2023-02-04', exercise: 'pullup', count: 16 },
            { date: '2023-02-05', exercise: 'pushup', count: 50 },
            { date: '2023-02-05', exercise: 'pullup', count: 18 },
            { date: '2023-02-06', exercise: 'pushup', count: 55 },
            { date: '2023-02-06', exercise: 'pullup', count: 20 },
            { date: '2023-02-07', exercise: 'pushup', count: 60 },
            { date: '2023-02-07', exercise: 'pullup', count: 22 },
            { date: '2023-02-08', exercise: 'pushup', count: 0 },
            { date: '2023-02-08', exercise: 'pullup', count: 0 },
            { date: '2023-02-09', exercise: 'pushup', count: 65 },
            { date: '2023-02-09', exercise: 'pullup', count: 24 },
            { date: '2023-02-10', exercise: 'pushup', count: 70 },
            { date: '2023-02-10', exercise: 'pullup', count: 25 },
            { date: '2023-02-11', exercise: 'pushup', count: 75 },
            { date: '2023-02-11', exercise: 'pullup', count: 26 },
            { date: '2023-02-12', exercise: 'pushup', count: 80 },
            { date: '2023-02-12', exercise: 'pullup', count: 28 },
            { date: '2023-02-13', exercise: 'pushup', count: 85 },
            { date: '2023-02-13', exercise: 'pullup', count: 30 },
            { date: '2023-02-14', exercise: 'pushup', count: 90 },
            { date: '2023-02-14', exercise: 'pullup', count: 32 }
        ];
        
        // Initialize the chart
        function initChart() {
            const ctx = document.getElementById('exerciseChart').getContext('2d');
            
            exerciseChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Pushups',
                            data: [],
                            backgroundColor: 'rgba(74, 144, 226, 0.2)',
                            borderColor: 'rgba(74, 144, 226, 1)',
                            borderWidth: 2,
                            pointBackgroundColor: 'rgba(74, 144, 226, 1)',
                            pointBorderColor: '#fff',
                            pointRadius: 5,
                            pointHoverRadius: 7,
                            tension: 0.1,
                            order: 1
                        },
                        {
                            label: 'Pullups',
                            data: [],
                            backgroundColor: 'rgba(226, 74, 74, 0.2)',
                            borderColor: 'rgba(226, 74, 74, 1)',
                            borderWidth: 2,
                            pointBackgroundColor: 'rgba(226, 74, 74, 1)',
                            pointBorderColor: '#fff',
                            pointRadius: 5,
                            pointHoverRadius: 7,
                            tension: 0.1,
                            order: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Reps'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                title: function(tooltipItems) {
                                    return new Date(tooltipItems[0].label).toLocaleDateString();
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Update chart with new data based on time period
        function updateChart(period = 'week') {
            if (!workoutData.length) return;
            
            // Get pushup and pullup data
            const pushupData = workoutData.filter(item => item.exercise === 'pushup');
            const pullupData = workoutData.filter(item => item.exercise === 'pullup');
            
            // Sort data by date
            const sortedPushupData = [...pushupData].sort((a, b) => new Date(a.date) - new Date(b.date));
            const sortedPullupData = [...pullupData].sort((a, b) => new Date(a.date) - new Date(b.date));
            
            // Get earliest and latest dates from either dataset
            const allDates = [...new Set([...pushupData.map(item => item.date), ...pullupData.map(item => item.date)])];
            const sortedDates = allDates.sort((a, b) => new Date(a) - new Date(b));
            
            if (sortedDates.length === 0) return;
            
            // Filter data based on selected time period
            let filteredDates = sortedDates;
            const now = new Date();
            
            if (period === 'week') {
                const oneWeekAgo = new Date(now);
                oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
                filteredDates = sortedDates.filter(date => new Date(date) >= oneWeekAgo);
            } else if (period === 'month') {
                const oneMonthAgo = new Date(now);
                oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
                filteredDates = sortedDates.filter(date => new Date(date) >= oneMonthAgo);
            } else if (period === 'year') {
                const oneYearAgo = new Date(now);
                oneYearAgo.setFullYear(oneYearAgo.getFullYear() - 1);
                filteredDates = sortedDates.filter(date => new Date(date) >= oneYearAgo);
            }
            
            if (filteredDates.length === 0) {
                // If no dates in the filtered range, show empty chart
                exerciseChart.data.labels = [];
                exerciseChart.data.datasets[0].data = [];
                exerciseChart.data.datasets[1].data = [];
                exerciseChart.update();
                return;
            }
            
            // Fill in all dates in the range
            const startDate = new Date(filteredDates[0]);
            const endDate = new Date(filteredDates[filteredDates.length - 1]);
            const dateRange = [];
            
            const currentDate = new Date(startDate);
            while (currentDate <= endDate) {
                dateRange.push(currentDate.toISOString().split('T')[0]);
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            // Create maps for quick lookup
            const pushupMap = new Map();
            sortedPushupData.forEach(item => {
                pushupMap.set(item.date, item.count);
            });
            
            const pullupMap = new Map();
            sortedPullupData.forEach(item => {
                pullupMap.set(item.date, item.count);
            });
            
            // Create datasets with all dates filled in
            const pushupDataset = dateRange.map(date => ({
                x: date,
                y: pushupMap.has(date) ? pushupMap.get(date) : 0
            }));
            
            const pullupDataset = dateRange.map(date => ({
                x: date,
                y: pullupMap.has(date) ? pullupMap.get(date) : 0
            }));
            
            // Update chart visibility based on toggle state
            exerciseChart.data.datasets[0].hidden = !showPushups;
            exerciseChart.data.datasets[1].hidden = !showPullups;
            
            // Update chart data
            exerciseChart.data.labels = dateRange;
            exerciseChart.data.datasets[0].data = pushupDataset;
            exerciseChart.data.datasets[1].data = pullupDataset;
            exerciseChart.update();
            
            // Update stats
            updatePushupStats(sortedPushupData);
            updatePullupStats(sortedPullupData);
        }
        
        // Update pushup stats
        function updatePushupStats(data) {
            // Calculate total pushups
            const totalPushups = data.reduce((sum, item) => sum + item.count, 0);
            document.getElementById('totalPushups').textContent = totalPushups;
            
            // Calculate average pushups per day with activity
            const daysWithActivity = data.filter(item => item.count > 0).length;
            const avgPushups = daysWithActivity ? Math.round(totalPushups / daysWithActivity) : 0;
            document.getElementById('averagePushups').textContent = avgPushups;
            
            // Find max pushups in one day
            const maxPushups = data.length ? Math.max(...data.map(item => item.count)) : 0;
            document.getElementById('maxPushups').textContent = maxPushups;
            
            // Calculate current streak
            const streak = calculateStreak(data);
            document.getElementById('currentPushupStreak').textContent = `${streak} day${streak !== 1 ? 's' : ''}`;
        }
        
        // Update pullup stats
        function updatePullupStats(data) {
            // Calculate total pullups
            const totalPullups = data.reduce((sum, item) => sum + item.count, 0);
            document.getElementById('totalPullups').textContent = totalPullups;
            
            // Calculate average pullups per day with activity
            const daysWithActivity = data.filter(item => item.count > 0).length;
            const avgPullups = daysWithActivity ? Math.round(totalPullups / daysWithActivity) : 0;
            document.getElementById('averagePullups').textContent = avgPullups;
            
            // Find max pullups in one day
            const maxPullups = data.length ? Math.max(...data.map(item => item.count)) : 0;
            document.getElementById('maxPullups').textContent = maxPullups;
            
            // Calculate current streak
            const streak = calculateStreak(data);
            document.getElementById('currentPullupStreak').textContent = `${streak} day${streak !== 1 ? 's' : ''}`;
        }
        
        // Calculate streak for a given exercise
        function calculateStreak(data) {
            if (!data.length) return 0;
            
            let currentStreak = 0;
            
            // Sort by date descending to check recent dates first
            const sortedDatesDesc = [...data].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Get today's date in YYYY-MM-DD format
            const today = new Date().toISOString().split('T')[0];
            const todayEntry = sortedDatesDesc.find(item => item.date === today);
            
            if (todayEntry && todayEntry.count > 0) {
                // If there's an entry for today with activity, start counting streak
                currentStreak = 1;
                
                // Check previous days
                let prevDate = new Date(today);
                while (true) {
                    prevDate.setDate(prevDate.getDate() - 1);
                    const prevDateStr = prevDate.toISOString().split('T')[0];
                    const entry = sortedDatesDesc.find(item => item.date === prevDateStr);
                    
                    if (entry && entry.count > 0) {
                        currentStreak++;
                    } else {
                        break;
                    }
                }
            } else {
                // Check if there was activity yesterday
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                const yesterdayStr = yesterday.toISOString().split('T')[0];
                const yesterdayEntry = sortedDatesDesc.find(item => item.date === yesterdayStr);
                
                if (yesterdayEntry && yesterdayEntry.count > 0) {
                    currentStreak = 1;
                    
                    // Check previous days
                    let prevDate = new Date(yesterdayStr);
                    while (true) {
                        prevDate.setDate(prevDate.getDate() - 1);
                        const prevDateStr = prevDate.toISOString().split('T')[0];
                        const entry = sortedDatesDesc.find(item => item.date === prevDateStr);
                        
                        if (entry && entry.count > 0) {
                            currentStreak++;
                        } else {
                            break;
                        }
                    }
                }
            }
            
            return currentStreak;
        }
        
        // Parse JSON data
        function parseJsonData(jsonString) {
            try {
                const data = JSON.parse(jsonString);
                
                if (!Array.isArray(data)) {
                    throw new Error('Data must be an array');
                }
                
                // Validate each entry
                const validData = data.filter(item => {
                    return item && typeof item === 'object' && 
                           item.date && typeof item.date === 'string' &&
                           !isNaN(new Date(item.date).getTime()) &&
                           'count' in item && !isNaN(parseInt(item.count)) &&
                           item.exercise && typeof item.exercise === 'string' &&
                           (item.exercise.toLowerCase() === 'pushup' || 
                            item.exercise.toLowerCase() === 'pullup');
                }).map(item => ({
                    date: new Date(item.date).toISOString().split('T')[0],
                    exercise: item.exercise.toLowerCase(),
                    count: parseInt(item.count)
                }));
                
                if (validData.length === 0) {
                    throw new Error('No valid data entries found');
                }
                
                return validData;
            } catch (error) {
                alert('Error parsing data: ' + error.message);
                return null;
            }
        }
        
        // Parse CSV data
        function parseCsvData(csvString) {
            try {
                const lines = csvString.split(/\r?\n/);
                const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
                
                const dateIndex = headers.findIndex(h => h.includes('date'));
                const exerciseIndex = headers.findIndex(h => 
                    h.includes('exercise') || 
                    h.includes('type') || 
                    h.includes('workout')
                );
                const countIndex = headers.findIndex(h => 
                    h.includes('count') || 
                    h.includes('reps') || 
                    h.includes('number')
                );
                
                if (dateIndex === -1 || countIndex === -1) {
                    throw new Error('CSV must contain date and count columns');
                }
                
                const data = [];
                for (let i = 1; i < lines.length; i++) {
                    if (!lines[i].trim()) continue;
                    
                    const values = lines[i].split(',');
                    const dateStr = values[dateIndex].trim();
                    const countStr = values[countIndex].trim();
                    
                    // If no exercise column, try to detect from other columns or default to pushup
                    let exercise = 'pushup';
                    if (exerciseIndex !== -1) {
                        const exerciseValue = values[exerciseIndex].trim().toLowerCase();
                        if (exerciseValue.includes('pull')) {
                            exercise = 'pullup';
                        } else if (exerciseValue.includes('push')) {
                            exercise = 'pushup';
                        }
                    }
                    
                    const date = new Date(dateStr);
                    if (isNaN(date.getTime())) continue;
                    
                    const count = parseInt(countStr);
                    if (isNaN(count)) continue;
                    
                    data.push({
                        date: date.toISOString().split('T')[0],
                        exercise: exercise,
                        count: count
                    });
                }
                
                if (data.length === 0) {
                    throw new Error('No valid data entries found in CSV');
                }
                
                return data;
            } catch (error) {
                alert('Error parsing CSV: ' + error.message);
                return null;
            }
        }
        
        // Handle file upload
        function handleFileUpload(file) {
            const reader = new FileReader();
            
            reader.onload = function(event) {
                const content = event.target.result;
                
                if (file.name.endsWith('.json')) {
                    const data = parseJsonData(content);
                    if (data) {
                        workoutData = data;
                        updateChart(getActivePeriod());
                    }
                } else if (file.name.endsWith('.csv')) {
                    const data = parseCsvData(content);
                    if (data) {
                        workoutData = data;
                        updateChart(getActivePeriod());
                    }
                } else {
                    alert('Unsupported file type. Please upload a JSON or CSV file.');
                }
            };
            
            reader.onerror = function() {
                alert('Error reading file');
            };
            
            if (file.name.endsWith('.json') || file.name.endsWith('.csv')) {
                reader.readAsText(file);
            } else {
                alert('Unsupported file type. Please upload a JSON or CSV file.');
            }
        }
        
        // Get active time period
        function getActivePeriod() {
            const activeBtn = document.querySelector('.period-btn.active');
            return activeBtn ? activeBtn.dataset.period : 'week';
        }
        
        // Toggle exercise visibility
        function toggleExerciseVisibility(exercise) {
            if (exercise === 'pushup') {
                showPushups = !showPushups;
                const btn = document.getElementById('pushupToggle');
                if (showPushups) {
                    btn.classList.remove('inactive');
                } else {
                    btn.classList.add('inactive');
                }
            } else if (exercise === 'pullup') {
                showPullups = !showPullups;
                const btn = document.getElementById('pullupToggle');
                if (showPullups) {
                    btn.classList.remove('inactive');
                } else {
                    btn.classList.add('inactive');
                }
            }
            
            updateChart(getActivePeriod());
        }
        
        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize chart
            initChart();
            
            // Load sample data initially
            workoutData = sampleData;
            updateChart('week');
            
            // Time period selection
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updateChart(this.dataset.period);
                });
            });
            
            // Exercise toggle
            document.getElementById('pushupToggle').addEventListener('click', function() {
                toggleExerciseVisibility('pushup');
            });
            
            document.getElementById('pullupToggle').addEventListener('click', function() {
                toggleExerciseVisibility('pullup');
            });
            
            // Import button
            document.getElementById('importBtn').addEventListener('click', function() {
                const inputData = document.getElementById('dataInput').value.trim();
                if (inputData) {
                    const data = parseJsonData(inputData);
                    if (data) {
                        workoutData =
