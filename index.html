<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>Workout Tracker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        /* Base Styles */
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            padding: 16px;
            background: #f0f2f5;
            line-height: 1.4;
            -webkit-text-size-adjust: 100%;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* Card Components */
        .card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* Input Fields and Buttons */
        .input-group {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        button {
            background: #007AFF;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }
        
        button:disabled {
            background: #ccc;
            cursor: default;
        }
        
        /* Stats Display */
        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }
        
        .goal-card {
            background: #e8f5e9;
            grid-column: span 2;
        }
        
        .pullup-goal {
            background: #e3f2fd;
        }
        
        .stat-label {
            font-size: 14px;
            color: #666;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #007AFF;
        }
        
        .goal-value {
            color: #2e7d32;
        }
        
        .pullup-value {
            color: #1565c0;
        }
        
        /* Logs */
        .log {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .log-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        /* Progress Indicators */
        .progress-bar {
            background: #e0e0e0;
            border-radius: 4px;
            height: 8px;
            margin-top: 8px;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .pushup-progress {
            background: #4caf50;
        }
        
        .pullup-progress {
            background: #2196f3;
        }
        
        /* Tab System */
        .tab-buttons {
            display: flex;
            margin-bottom: 16px;
            gap: 8px;
        }
        
        .tab-button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            background: #f0f0f0;
            color: #666;
        }
        
        .tab-button.active {
            background: #007AFF;
            color: white;
        }
        
        /* Exercise Type Labels */
        .exercise-type {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            margin-right: 8px;
        }
        
        .pushup-type {
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        .pullup-type {
            background: #e3f2fd;
            color: #1565c0;
        }
        
        /* Notification Settings */
        .notification-settings {
            margin-top: 12px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .switch {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .time-select {
            margin-top: 8px;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
            width: 100%;
        }
        
        /* Visualization Styles */
        .view-toggle {
            display: flex;
            margin-top: 20px;
            margin-bottom: 16px;
            gap: 8px;
        }
        
        .view-tab {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            background: #f0f0f0;
            color: #666;
            text-align: center;
        }
        
        .view-tab.active {
            background: #007AFF;
            color: white;
        }
        
        #tracker-view, #visualization-view {
            display: none;
        }
        
        #tracker-view.active, #visualization-view.active {
            display: block;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 16px;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        
        .chart-container {
            position: relative;
            height: 250px;
            width: 100%;
            margin-top: 10px;
        }
        
        .exercise-toggle {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .time-period {
            display: flex;
            gap: 4px;
            margin-bottom: 12px;
        }
        
        .time-period button {
            flex: 1;
            padding: 8px 4px;
            font-size: 14px;
        }
        
        /* Color coding for the stats */
        .pushup-stats h2 {
            color: #4a90e2;
        }
        
        .pullup-stats h2 {
            color: #e24a4a;
        }
        
        #pushupToggle {
            background-color: #4a90e2;
        }
        
        #pullupToggle {
            background-color: #e24a4a;
        }
        
        #pushupToggle.inactive, 
        #pullupToggle.inactive {
            background-color: #f5f7fa;
            color: #666;
            border: 1px solid #ddd;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- View Toggle Tabs -->
        <div class="view-toggle">
            <button id="trackerTab" class="view-tab active" onclick="switchView('tracker')">Tracker</button>
            <button id="visualizationTab" class="view-tab" onclick="switchView('visualization')">Visualization</button>
        </div>
        
        <!-- Tracker View -->
        <div id="tracker-view" class="active">
            <div class="card">
                <h2>Workout Tracker</h2>
                <div class="tab-buttons">
                    <button id="pushupTab" class="tab-button active" onclick="switchTab('pushup')">Pushups</button>
                    <button id="pullupTab" class="tab-button" onclick="switchTab('pullup')">Pullups</button>
                </div>
                <div class="input-group">
                    <input type="number" id="exerciseCount" placeholder="Number of pushups">
                    <button onclick="logExercise()" id="logButton">Log</button>
                </div>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-label">Today</div>
                        <div class="stat-value" id="todayCount">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total</div>
                        <div class="stat-value" id="totalCount">0</div>
                    </div>
                    <div class="stat-card goal-card" id="pushupGoalCard">
                        <div class="stat-label">2025 Pushup Goal Progress</div>
                        <div class="stat-value goal-value" id="pushupGoalProgress">0/10000</div>
                        <div class="progress-bar">
                            <div class="progress-fill pushup-progress" id="pushupProgressBar" style="width: 0%"></div>
                        </div>
                        <div class="stat-label" style="margin-top: 8px;">
                            Daily target: <span id="pushupDailyTarget">0</span> pushups
                        </div>
                    </div>
                    <div class="stat-card goal-card pullup-goal" id="pullupGoalCard">
                        <div class="stat-label">2025 Pullup Goal Progress</div>
                        <div class="stat-value pullup-value" id="pullupGoalProgress">0/1000</div>
                        <div class="progress-bar">
                            <div class="progress-fill pullup-progress" id="pullupProgressBar" style="width: 0%"></div>
                        </div>
                        <div class="stat-label" style="margin-top: 8px;">
                            Daily target: <span id="pullupDailyTarget">0</span> pullups
                        </div>
                    </div>
                </div>
            </div>
    
            <div class="card">
                <h3>Notification Settings</h3>
                <div class="notification-settings">
                    <div class="switch">
                        <input type="checkbox" id="notificationToggle" onclick="toggleNotifications()">
                        <label for="notificationToggle">Enable daily reminder</label>
                    </div>
                    <select id="reminderTime" class="time-select" onchange="updateReminderTime()">
                        <option value="20:00">8:00 PM</option>
                        <option value="19:00">7:00 PM</option>
                        <option value="21:00">9:00 PM</option>
                    </select>
                </div>
            </div>
    
            <div class="card">
                <h3>Recent Logs</h3>
                <div class="log" id="logList"></div>
            </div>
        </div>
        
        <!-- Visualization View -->
        <div id="visualization-view">
            <div class="card">
                <h2>Workout History</h2>
                
                <div class="stats-grid">
                    <div class="card pushup-stats">
                        <h2>Pushups</h2>
                        <div class="stats-container">
                            <div class="stat-card">
                                <h3>Total</h3>
                                <p id="totalPushups">0</p>
                            </div>
                            <div class="stat-card">
                                <h3>Average</h3>
                                <p id="averagePushups">0</p>
                            </div>
                            <div class="stat-card">
                                <h3>Max</h3>
                                <p id="maxPushups">0</p>
                            </div>
                            <div class="stat-card">
                                <h3>Streak</h3>
                                <p id="currentPushupStreak">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card pullup-stats">
                        <h2>Pullups</h2>
                        <div class="stats-container">
                            <div class="stat-card">
                                <h3>Total</h3>
                                <p id="totalPullups">0</p>
                            </div>
                            <div class="stat-card">
                                <h3>Average</h3>
                                <p id="averagePullups">0</p>
                            </div>
                            <div class="stat-card">
                                <h3>Max</h3>
                                <p id="maxPullups">0</p>
                            </div>
                            <div class="stat-card">
                                <h3>Streak</h3>
                                <p id="currentPullupStreak">0</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="exercise-toggle">
                    <button id="pushupToggle">Show Pushups</button>
                    <button id="pullupToggle">Show Pullups</button>
                </div>
                
                <div class="time-period">
                    <button class="period-btn active" data-period="week">Week</button>
                    <button class="period-btn" data-period="month">Month</button>
                    <button class="period-btn" data-period="year">Year</button>
                    <button class="period-btn" data-period="all">All</button>
                </div>
                
                <div class="chart-container">
                    <canvas id="exerciseChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ======================
        // SHARED VARIABLES
        // ======================
        const PUSHUP_GOAL = 10000;
        const PULLUP_GOAL = 1000;
        let currentExercise = 'pushup';
        let notificationTimer;
        
        // Load data from localStorage - maintain backward compatibility
        let pushupLogs = JSON.parse(localStorage.getItem('pushupLogs')) || [];
        let pullupLogs = JSON.parse(localStorage.getItem('pullupLogs')) || [];
        
        // For visualization
        let exerciseChart;
        let showPushups = true;
        let showPullups = true;
        
        // ======================
        // VIEW SWITCHING
        // ======================
        function switchView(view) {
            document.getElementById('tracker-view').classList.toggle('active', view === 'tracker');
            document.getElementById('visualization-view').classList.toggle('active', view === 'visualization');
            
            document.getElementById('trackerTab').classList.toggle('active', view === 'tracker');
            document.getElementById('visualizationTab').classList.toggle('active', view === 'visualization');
            
            if (view === 'visualization') {
                initializeVisualization();
            }
        }
        
        // ======================
        // TRACKER FUNCTIONS
        // ======================
        function getDaysLeftInYear() {
            const today = new Date();
            const endOfYear = new Date(2025, 11, 31);
            const diffTime = Math.abs(endOfYear - today);
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        }

        function calculateDailyTarget(logs, goal) {
            const totalDone = logs.reduce((sum, log) => sum + log.count, 0);
            const remaining = goal - totalDone;
            const daysLeft = getDaysLeftInYear();
            return Math.ceil(Math.max(0, remaining / daysLeft));
        }

        function switchTab(exercise) {
            currentExercise = exercise;
            document.getElementById('pushupTab').classList.toggle('active', exercise === 'pushup');
            document.getElementById('pullupTab').classList.toggle('active', exercise === 'pullup');
            document.getElementById('exerciseCount').placeholder = `Number of ${exercise}s`;
            updateDisplay();
        }

        function logExercise() {
            const input = document.getElementById('exerciseCount');
            const count = parseInt(input.value);
            if (isNaN(count) || count <= 0) return;

            const log = {
                date: new Date().toISOString(),
                count: count
            };

            if (currentExercise === 'pushup') {
                pushupLogs.unshift(log);
                localStorage.setItem('pushupLogs', JSON.stringify(pushupLogs));
            } else {
                pullupLogs.unshift(log);
                localStorage.setItem('pullupLogs', JSON.stringify(pullupLogs));
            }

            input.value = '';
            updateDisplay();
            
            // If visualization has been initialized already, update it too
            if (exerciseChart) {
                updateVisualizationData();
            }
            
            // Reschedule notification if needed
            if (document.getElementById('notificationToggle').checked) {
                scheduleNotification();
            }
        }

        function updateDisplay() {
            const today = new Date().toDateString();
            const logs = currentExercise === 'pushup' ? pushupLogs : pullupLogs;
            
            const todayTotal = logs
                .filter(log => new Date(log.date).toDateString() === today)
                .reduce((sum, log) => sum + log.count, 0);

            const allTimeTotal = logs.reduce((sum, log) => sum + log.count, 0);
            
            // Update basic stats
            document.getElementById('todayCount').textContent = todayTotal;
            document.getElementById('totalCount').textContent = allTimeTotal;
            
            // Update both goal progresses
            const pushupTotal = pushupLogs.reduce((sum, log) => sum + log.count, 0);
            const pullupTotal = pullupLogs.reduce((sum, log) => sum + log.count, 0);
            
            const pushupPercent = (pushupTotal / PUSHUP_GOAL) * 100;
            const pullupPercent = (pullupTotal / PULLUP_GOAL) * 100;
            
            document.getElementById('pushupGoalProgress').textContent = `${pushupTotal}/${PUSHUP_GOAL}`;
            document.getElementById('pullupGoalProgress').textContent = `${pullupTotal}/${PULLUP_GOAL}`;
            document.getElementById('pushupProgressBar').style.width = `${Math.min(100, pushupPercent)}%`;
            document.getElementById('pullupProgressBar').style.width = `${Math.min(100, pullupPercent)}%`;
            
            // Update daily targets
            document.getElementById('pushupDailyTarget').textContent = calculateDailyTarget(pushupLogs, PUSHUP_GOAL);
            document.getElementById('pullupDailyTarget').textContent = calculateDailyTarget(pullupLogs, PULLUP_GOAL);

            // Update log list with combined logs
            const combinedLogs = [...pushupLogs, ...pullupLogs]
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 10);

            const logList = document.getElementById('logList');
            logList.innerHTML = combinedLogs
                .map(log => {
                    const isFromPushupLog = pushupLogs.some(p => p.date === log.date && p.count === log.count);
                    const type = isFromPushupLog ? 'pushup' : 'pullup';
                    return `
                        <div class="log-item">
                            <span>
                                <span class="exercise-type ${type}-type">${type}s</span>
                                ${new Date(log.date).toLocaleDateString()}
                            </span>
                            <span>${log.count} reps</span>
                        </div>
                    `;
                })
                .join('');
        }

        async function setupNotifications() {
            if (!('Notification' in window)) {
                alert('This browser does not support notifications');
                return;
            }

            const permission = await Notification.requestPermission();
            if (permission === 'granted') {
                const notificationEnabled = localStorage.getItem('notificationEnabled') === 'true';
                document.getElementById('notificationToggle').checked = notificationEnabled;
                if (notificationEnabled) {
                    scheduleNotification();
                }
            }
        }

        function toggleNotifications() {
            const enabled = document.getElementById('notificationToggle').checked;
            localStorage.setItem('notificationEnabled', enabled);
            if (enabled) {
                scheduleNotification();
            } else {
                if (notificationTimer) clearTimeout(notificationTimer);
            }
        }

        function updateReminderTime() {
            if (document.getElementById('notificationToggle').checked) {
                scheduleNotification();
            }
        }

        function scheduleNotification() {
            if (notificationTimer) clearTimeout(notificationTimer);
            
            const reminderTime = document.getElementById('reminderTime').value;
            const [hours, minutes] = reminderTime.split(':').map(Number);
            
            const now = new Date();
            const scheduledTime = new Date(
                now.getFullYear(),
                now.getMonth(),
                now.getDate(),
                hours,
                minutes
            );
            
            if (scheduledTime <= now) {
                scheduledTime.setDate(scheduledTime.getDate() + 1);
            }
            
            const timeUntilNotification = scheduledTime - now;
            
            notificationTimer = setTimeout(() => {
                checkAndNotify();
                scheduleNotification(); // Schedule next day's notification
            }, timeUntilNotification);
        }

        function checkAndNotify() {
            const today = new Date().toDateString();
            const pushupToday = pushupLogs.some(log => 
                new Date(log.date).toDateString() === today
            );
            const pullupToday = pullupLogs.some(log => 
                new Date(log.date).toDateString() === today
            );

            if (!pushupToday || !pullupToday) {
                const missingExercises = [];
                if (!pushupToday) missingExercises.push('pushups');
                if (!pullupToday) missingExercises.push('pullups');
                
                new Notification('Workout Reminder', {
                    body: `Don't forget to log your ${missingExercises.join(' and ')} for today!`,
                    icon: '/favicon.ico'
                });
            }
        }
        
        // ======================
        // VISUALIZATION FUNCTIONS
        // ======================
        
        function initializeVisualization() {
            // Only initialize once
            if (!exerciseChart) {
                initChart();
                updateVisualizationData();
            }
        }
        
        // Initialize the chart
        function initChart() {
            const ctx = document.getElementById('exerciseChart').getContext('2d');
            
            // Set Chart.js default font
            Chart.defaults.font.family = '-apple-system, BlinkMacSystemFont, sans-serif';
            Chart.defaults.font.size = 12;
            
            exerciseChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Pushups',
                            data: [],
                            backgroundColor: 'rgba(74, 144, 226, 0.2)',
                            borderColor: 'rgba(74, 144, 226, 1)',
                            borderWidth: 2,
                            pointBackgroundColor: 'rgba(74, 144, 226, 1)',
                            pointBorderColor: '#fff',
                            pointRadius: 3,
                            pointHoverRadius: 5,
                            tension: 0.1,
                            order: 1
                        },
                        {
                            label: 'Pullups',
                            data: [],
                            backgroundColor: 'rgba(226, 74, 74, 0.2)',
                            borderColor: 'rgba(226, 74, 74, 1)',
                            borderWidth: 2,
                            pointBackgroundColor: 'rgba(226, 74, 74, 1)',
                            pointBorderColor: '#fff',
                            pointRadius: 3,
                            pointHoverRadius: 5,
                            tension: 0.1,
                            order: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: false
                            },
                            ticks: {
                                padding: 5
                            }
                        },
                        x: {
                            title: {
                                display: false
                            },
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45,
                                padding: 5,
                                callback: function(value, index, values) {
                                    const label = this.getLabelForValue(value);
                                    const date = new Date(label);
                                    return (date.getMonth() + 1) + "/" + date.getDate();
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                title: function(tooltipItems) {
                                    return new Date(tooltipItems[0].label).toLocaleDateString();
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Format and update visualization data directly from pushupLogs and pullupLogs
        function updateVisualizationData() {
            // Format data from logs
            const formattedPushups = pushupLogs.map(log => ({
                date: new Date(log.date).toISOString().split('T')[0],
                exercise: 'pushup',
                count: log.count
            }));
            
            const formattedPullups = pullupLogs.map(log => ({
                date: new Date(log.date).toISOString().split('T')[0],
                exercise: 'pullup',
                count: log.count
            }));
            
            const workoutData = [...formattedPushups, ...formattedPullups];
            
            // Update chart with this data
            updateChart(workoutData, getActivePeriod());
        }
        
        // Get active time period for visualization
        function getActivePeriod() {
            const activeBtn = document.querySelector('.period-btn.active');
            return activeBtn ? activeBtn.dataset.period : 'week';
        }
        
        // Update chart with workout data and time period
        function updateChart(workoutData, period = 'week') {
            if (!workoutData.length || !exerciseChart) return;
            
            // Get pushup and pullup data
            const pushupData = workoutData.filter(item => item.exercise === 'pushup');
            const pullupData = workoutData.filter(item => item.exercise === 'pullup');
            
            // Sort data by date
            const sortedPushupData = [...pushupData].sort((a, b) => new Date(a.date) - new Date(b.date));
            const sortedPullupData = [...pullupData].sort((a, b) => new Date(a.date) - new Date(b.date));
            
            // Get earliest and latest dates from either dataset
            const allDates = [...new Set([...pushupData.map(item => item.date), ...pullupData.map(item => item.date)])];
            const sortedDates = allDates.sort((a, b) => new Date(a) - new Date(b));
            
            if (sortedDates.length === 0) return;
            
            // Filter data based on selected time period
            let filteredDates = sortedDates;
            const now = new Date();
            
            if (period === 'week') {
                const oneWeekAgo = new Date(now);
                oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
                filteredDates = sortedDates.filter(date => new Date(date) >= oneWeekAgo);
            } else if (period === 'month') {
                const oneMonthAgo = new Date(now);
                oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
                filteredDates = sortedDates.filter(date => new Date(date) >= oneMonthAgo);
            } else if (period === 'year') {
                const oneYearAgo = new Date(now);
                oneYearAgo.setFullYear(oneYearAgo.getFullYear() - 1);
                filteredDates = sortedDates.filter(date => new Date(date) >= oneYearAgo);
            }
            
            if (filteredDates.length === 0) {
                // If no dates in the filtered range, show empty chart
                exerciseChart.data.labels = [];
                exerciseChart.data.datasets[0].data = [];
                exerciseChart.data.datasets[1].data = [];
                exerciseChart.update();
                return;
            }
            
            // Fill in all dates in the range
            const startDate = new Date(filteredDates[0]);
            const endDate = new Date(filteredDates[filteredDates.length - 1]);
            const dateRange = [];
            
            const currentDate = new Date(startDate);
            while (currentDate <= endDate) {
                dateRange.push(currentDate.toISOString().split('T')[0]);
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            // Create maps for quick lookup
            const pushupMap = new Map();
            sortedPushupData.forEach(item => {
                pushupMap.set(item.date, item.count);
            });
            
            const pullupMap = new Map();
            sortedPullupData.forEach(item => {
                pullupMap.set(item.date, item.count);
            });
            
            // Create datasets with all dates filled in
            const pushupDataset = dateRange.map(date => ({
                x: date,
                y: pushupMap.has(date) ? pushupMap.get(date) : 0
            }));
            
            const pullupDataset = dateRange.map(date => ({
                x: date,
                y: pullupMap.has(date) ? pullupMap.get(date) : 0
            }));
            
            // Update chart visibility based on toggle state
            exerciseChart.data.datasets[0].hidden = !showPushups;
            exerciseChart.data.datasets[1].hidden = !showPullups;
            
            // Update chart data
            exerciseChart.data.labels = dateRange;
            exerciseChart.data.datasets[0].data = pushupDataset;
            exerciseChart.data.datasets[1].data = pullupDataset;
            exerciseChart.update();
            
            // Update stats
            updatePushupStats(sortedPushupData);
            updatePullupStats(sortedPullupData);
        }
        
        // Toggle exercise visibility in chart
        function toggleExerciseVisibility(exercise) {
            if (exercise === 'pushup') {
                showPushups = !showPushups;
                const btn = document.getElementById('pushupToggle');
                if (showPushups) {
                    btn.classList.remove('inactive');
                    btn.style.backgroundColor = '#4a90e2';
                    btn.style.color = 'white';
                } else {
                    btn.classList.add('inactive');
                    btn.style.backgroundColor = '#f5f7fa';
                    btn.style.color = '#666';
                }
            } else if (exercise === 'pullup') {
                showPullups = !showPullups;
                const btn = document.getElementById('pullupToggle');
                if (showPullups) {
                    btn.classList.remove('inactive');
                    btn.style.backgroundColor = '#e24a4a';
                    btn.style.color = 'white';
                } else {
                    btn.classList.add('inactive');
                    btn.style.backgroundColor = '#f5f7fa';
                    btn.style.color = '#666';
                }
            }
            
            // Force update the chart
            if (exerciseChart) {
                exerciseChart.data.datasets[0].hidden = !showPushups;
                exerciseChart.data.datasets[1].hidden = !showPullups;
                exerciseChart.update();
            }
        }
        
        // Update pushup stats for visualization
        function updatePushupStats(data) {
            // Calculate total pushups
            const totalPushups = data.reduce((sum, item) => sum + item.count, 0);
            document.getElementById('totalPushups').textContent = totalPushups;
            
            // Calculate average pushups per day with activity
            const daysWithActivity = data.filter(item => item.count > 0).length;
            const avgPushups = daysWithActivity ? Math.round(totalPushups / daysWithActivity) : 0;
            document.getElementById('averagePushups').textContent = avgPushups;
            
            // Find max pushups in one day
            const maxPushups = data.length ? Math.max(...data.map(item => item.count)) : 0;
            document.getElementById('maxPushups').textContent = maxPushups;
            
            // Calculate current streak
            const streak = calculateStreak(data);
            document.getElementById('currentPushupStreak').textContent = streak;
        }
        
        // Update pullup stats for visualization
        function updatePullupStats(data) {
            // Calculate total pullups
            const totalPullups = data.reduce((sum, item) => sum + item.count, 0);
            document.getElementById('totalPullups').textContent = totalPullups;
            
            // Calculate average pullups per day with activity
            const daysWithActivity = data.filter(item => item.count > 0).length;
            const avgPullups = daysWithActivity ? Math.round(totalPullups / daysWithActivity) : 0;
            document.getElementById('averagePullups').textContent = avgPullups;
            
            // Find max pullups in one day
            const maxPullups = data.length ? Math.max(...data.map(item => item.count)) : 0;
            document.getElementById('maxPullups').textContent = maxPullups;
            
            // Calculate current streak
            const streak = calculateStreak(data);
            document.getElementById('currentPullupStreak').textContent = streak;
        }
        
        // Calculate streak for visualization
        function calculateStreak(data) {
            if (!data.length) return 0;
            
            let currentStreak = 0;
            
            // Sort by date descending to check recent dates first
            const sortedDatesDesc = [...data].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Get today's date in YYYY-MM-DD format
            const today = new Date().toISOString().split('T')[0];
            const todayEntry = sortedDatesDesc.find(item => item.date === today);
            
            if (todayEntry && todayEntry.count > 0) {
                // If there's an entry for today with activity, start counting streak
                currentStreak = 1;
                
                // Check previous days
                let prevDate = new Date(today);
                while (true) {
                    prevDate.setDate(prevDate.getDate() - 1);
                    const prevDateStr = prevDate.toISOString().split('T')[0];
                    const entry = sortedDatesDesc.find(item => item.date === prevDateStr);
                    
                    if (entry && entry.count > 0) {
                        currentStreak++;
                    } else {
                        break;
                    }
                }
            } else {
                // Check if there was activity yesterday
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                const yesterdayStr = yesterday.toISOString().split('T')[0];
                const yesterdayEntry = sortedDatesDesc.find(item => item.date === yesterdayStr);
                
                if (yesterdayEntry && yesterdayEntry.count > 0) {
                    currentStreak = 1;
                    
                    // Check previous days
                    let prevDate = new Date(yesterdayStr);
                    while (true) {
                        prevDate.setDate(prevDate.getDate() - 1);
                        const prevDateStr = prevDate.toISOString().split('T')[0];
                        const entry = sortedDatesDesc.find(item => item.date === prevDateStr);
                        
                        if (entry && entry.count > 0) {
                            currentStreak++;
                        } else {
                            break;
                        }
                    }
                }
            }
            
            return currentStreak;
        }
        
        // ======================
        // INITIALIZATION
        // ======================
        
        // Initialize tracker on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize tracker view
            updateDisplay();
            
            // Setup event listeners for tracker
            document.getElementById('exerciseCount').addEventListener('input', function() {
                const value = this.value;
                document.getElementById('logButton').disabled = !value || parseInt(value) <= 0;
            });
            
            // Setup event listeners for visualization
            document.getElementById('pushupToggle').addEventListener('click', function() {
                toggleExerciseVisibility('pushup');
            });
            
            document.getElementById('pullupToggle').addEventListener('click', function() {
                toggleExerciseVisibility('pullup');
            });
            
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updateVisualizationData();
                });
            });
            
            // Setup notifications
            setupNotifications();
        });
    </script>
</body>
</html>
